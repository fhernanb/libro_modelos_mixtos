[["IC.html", "28 Intervalos de confianza 28.1 Intervalos de confianza para los parámetros Ejemplo: modelo normal Ejemplo: modelo gamma", " 28 Intervalos de confianza En este capítulo vamos mostrar como se pueden obtener intervalos de confianza para los parámetros del modelo e intervalos de confianza para predicción. 28.1 Intervalos de confianza para los parámetros En esta sección se mostrará cómo utilizar la función confint() para obtener intervalos de confianza para los elementos del vector de parámetros \\(\\boldsymbol{\\Theta}\\) de un modelo lineal generalizado mixto. Ejemplo: modelo normal En este ejemplo su usará la base de datos sleepstudy del paquete lme4 sobre el tiempo de reacción promedio por día para un conjunto de individuos en un estudio de privación del sueño. La base de datos contiene la información sobre el tiempo de reacción promedio (Reaction), el número de días de privación del sueño (Days), donde el día 0 corresponde al día en el que los indiviuos tenían su cantidad normal de sueño, y el número del individuo (en total 18) sobre el que se realizó la observación (Subject). A partir del día 0, hubo una restricción en cada individuo a 3 horas de sueño por noche. El objetivo es ajustar el siguiente modelo a los datos. \\[\\begin{align*} Reaction_{ij} | b_0, b_1 &amp;\\sim N(\\mu_{ij}, \\sigma^2_{Reaction}) \\\\ \\mu_{ij} &amp;= \\beta_0 + \\beta_1 Days_{ij} + b_{0i} + b_{1i} Days_{ij} \\\\ \\left ( \\begin{matrix} b_{0} \\\\ b_{1} \\end{matrix} \\right ) &amp;\\sim N\\left ( \\left [ \\begin{matrix} 0 \\\\ 0 \\end{matrix} \\right ], \\left [ \\begin{matrix} \\sigma^2_{b0} &amp; \\sigma_{b01} \\\\ \\sigma_{b01} &amp; \\sigma^2_{b1} \\end{matrix} \\right ] \\right ) \\end{align*}\\] Lo primero que debemos hacer es ajustar el modelo usando el siguiente código. library(lme4) ## Loading required package: Matrix head(sleepstudy) ## Reaction Days Subject ## 1 249.5600 0 308 ## 2 258.7047 1 308 ## 3 250.8006 2 308 ## 4 321.4398 3 308 ## 5 356.8519 4 308 ## 6 414.6901 5 308 fit &lt;- lmer(Reaction ~ Days + (Days | Subject), REML = TRUE, data = sleepstudy) La tabla de resultados del modelo ajustado se muestra a continuación. summary(fit) ## Linear mixed model fit by REML [&#39;lmerMod&#39;] ## Formula: Reaction ~ Days + (Days | Subject) ## Data: sleepstudy ## ## REML criterion at convergence: 1743.6 ## ## Scaled residuals: ## Min 1Q Median 3Q Max ## -3.9536 -0.4634 0.0231 0.4634 5.1793 ## ## Random effects: ## Groups Name Variance Std.Dev. Corr ## Subject (Intercept) 612.10 24.741 ## Days 35.07 5.922 0.07 ## Residual 654.94 25.592 ## Number of obs: 180, groups: Subject, 18 ## ## Fixed effects: ## Estimate Std. Error t value ## (Intercept) 251.405 6.825 36.838 ## Days 10.467 1.546 6.771 ## ## Correlation of Fixed Effects: ## (Intr) ## Days -0.138 De la tabla anterior podemos ver que las estimaciones del vector de parámetros es \\[ \\hat{\\boldsymbol{\\Theta}} = (\\hat{\\beta_0}=251.40, \\hat{\\beta_1}=10.47, \\hat{\\sigma}_{reaction}=25.59, \\hat{\\sigma}_{b0}=24.74, \\hat{\\sigma}_{b1}=5.92, \\hat{\\rho}_{b0b1}=0.07)^\\top \\] Para obtener los intervalos de confianza podemos usar la función confint() al objeto fit. #### Calculate Wald CIs (Fastest Version) #### ci.wald &lt;- confint(fit, level=0.95) ## Computing profile confidence intervals ... ci.wald ## 2.5 % 97.5 % ## .sig01 14.3814379 37.7159918 ## .sig02 -0.4815008 0.6849863 ## .sig03 3.8011643 8.7533658 ## .sigma 22.8982669 28.8579965 ## (Intercept) 237.6806955 265.1295145 ## Days 7.3586533 13.5759188 También es posible obtener los intervalos de confianza por el método boostrap así. #### Calculate Bootstrapped CIs #### ci.boot &lt;- confint(fit, method = &quot;boot&quot;, nsim = 1000) ## Computing bootstrap confidence intervals ... ## ## 13 message(s): boundary (singular) fit: see help(&#39;isSingular&#39;) ## 12 warning(s): Model failed to converge with max|grad| = 0.00209107 (tol = 0.002, component 1) (and others) ci.boot ## 2.5 % 97.5 % ## .sig01 12.9467389 34.841487 ## .sig02 -0.4776721 0.919507 ## .sig03 3.2999675 8.264178 ## .sigma 22.3719980 28.275528 ## (Intercept) 237.1623187 265.317540 ## Days 7.4006700 13.759130 Ejemplo: modelo gamma En este ejemplo analizamos los datos de semiconductores tomados de Myers et al. (2002) sobre un experimento diseñado en una planta de semiconductores. Se emplean seis factores, temperatura de laminación, tiempo de laminación, presión de laminación, temperatura de cocción, tiempo de ciclo de cocción y punto de rocío de cocción, y estamos interesados en la curvatura de los dispositivos de sustrato producidos en la planta. La medición de la curvatura se realiza cuatro veces en cada dispositivo fabricado. Cada variable de diseño se toma en dos niveles. Se sabe que la medida no tiene una distribución normal y las medidas tomadas en el mismo dispositivo están correlacionadas. Las variables de la base de datos se muestran a continuación. Device: Subtrate device x1: Lamination Temperature; two levels +1 and -1. x2: Lamination Time; two levels: +1 and -1. x3: Lamination Presure; two levels: +1 and -1. x4: Firing Temperature; two levels: +1 and -1. x5: Firing Cycle Time; two levels: +1 and -1. x6: Firing Dew Point: two levels: +1 and -1. y: Camber measure; in 1e-4 in./in. El objetivo es ajustar el siguiente modelo a los datos. \\[\\begin{align*} y_{ij} | b_0 &amp;\\sim Gamma(\\mu_{ij}, \\phi) \\\\ \\log(\\mu_{ij}) &amp;= \\beta_0 + \\beta_1 x1_{ij} + \\beta_3 x3_{ij} + \\beta_5 x5_{ij} + \\beta_6 x6_{ij} + b_{0i} \\\\ b_{0} &amp;\\sim N(0, \\sigma^2_{b0}) \\end{align*}\\] Para ajustar el modelo anterior usamos el siguiente código. library(hglm) data(semiconductor) library(lme4) fit &lt;- glmer(y ~ x1 + x3 + x5 + x6 + (1 | Device), data = semiconductor, family = Gamma(link = log)) summary(fit) ## Generalized linear mixed model fit by maximum likelihood (Laplace ## Approximation) [glmerMod] ## Family: Gamma ( log ) ## Formula: y ~ x1 + x3 + x5 + x6 + (1 | Device) ## Data: semiconductor ## ## AIC BIC logLik -2*log(L) df.resid ## -551.0 -535.9 282.5 -565.0 57 ## ## Scaled residuals: ## Min 1Q Median 3Q Max ## -1.8424 -0.5565 -0.1762 0.7429 2.4663 ## ## Random effects: ## Groups Name Variance Std.Dev. ## Device (Intercept) 0.02744 0.1657 ## Residual 0.09652 0.3107 ## Number of obs: 64, groups: Device, 16 ## ## Fixed effects: ## Estimate Std. Error t value Pr(&gt;|z|) ## (Intercept) -4.71177 0.07542 -62.475 &lt; 2e-16 *** ## x1 0.18429 0.07541 2.444 0.0145 * ## x3 0.30732 0.07540 4.076 4.59e-05 *** ## x5 -0.19423 0.07543 -2.575 0.0100 * ## x6 -0.36594 0.07540 -4.853 1.21e-06 *** ## --- ## Signif. codes: 0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1 ## ## Correlation of Fixed Effects: ## (Intr) x1 x3 x5 ## x1 0.000 ## x3 0.000 0.008 ## x5 0.000 0.023 0.021 ## x6 0.000 -0.007 0.005 0.014 De la tabla anterior podemos ver que las estimaciones del vector de parámetros es \\[ \\hat{\\boldsymbol{\\Theta}} = (\\hat{\\beta_0}=-4.71, \\hat{\\beta_1}=0.18, \\hat{\\beta_3}=0.31, \\hat{\\beta_5}=-0.19, \\hat{\\beta_6}=-0.37, \\hat{\\phi}=0.31, \\hat{\\sigma}_{b0}=0.17)^\\top \\] Para obtener los intervalos de confianza podemos usar la función confint() al objeto fit. "],["intervalos-de-confianza-para-predicción.html", "29 Intervalos de confianza para predicción", " 29 Intervalos de confianza para predicción library(lme4) #first case simple lmer, simulate 100 data points from 10 groups with one continuous fixed effect variable x &lt;- runif(100, 0, 10) f &lt;- gl(n=10, k=10) data &lt;- data.frame(x=x, f=f) modmat &lt;- model.matrix(~x,data) #the fixed effect coefficient fixed &lt;- c(1, 0.5) #the random effect rnd &lt;- rnorm(10, 0, 0.7) #the simulated response values data$y &lt;- rnorm(100, modmat%*%fixed+rnd[f], 0.3) #model m &lt;- lmer(y ~ x + (1|f), data) #first CI and PI using predict-like method, using code posted here: http://glmm.wikidot.com/faq newdat &lt;- data.frame(x=seq(0, 10, length=20)) mm &lt;- model.matrix(~x, newdat) newdat$y &lt;- mm%*%fixef(m) #predict(m,newdat,re.form=NA) would give the same results pvar1 &lt;- diag(mm %*% tcrossprod(vcov(m),mm)) tvar1 &lt;- pvar1+VarCorr(m)$f[1] # must be adapted for more complex models newdat &lt;- data.frame( newdat , plo = newdat$y-1.96*sqrt(pvar1) , phi = newdat$y+1.96*sqrt(pvar1) , tlo = newdat$y-1.96*sqrt(tvar1) , thi = newdat$y+1.96*sqrt(tvar1) ) #second version with bootMer #we have to define a function that will be applied to the nsim simulations #here we basically get a merMod object and return the fitted values predFun &lt;- function(.) mm%*%fixef(.) bb &lt;- bootMer(m,FUN=predFun,nsim=200) #do this 200 times #as we did this 200 times the 95% CI will be bordered by the 5th and 195th value bb_se &lt;- apply(bb$t,2,function(x) x[order(x)]) #[c language=&quot;(5,195)&quot;][/c]) newdat$blo &lt;- bb_se[1,] newdat$bhi &lt;- bb_se[2,] plot(y~x, data) lines(newdat$x,newdat$y,col=&quot;red&quot;,lty=2,lwd=3) lines(newdat$x,newdat$plo,col=&quot;blue&quot;,lty=2,lwd=2) lines(newdat$x,newdat$phi,col=&quot;blue&quot;,lty=2,lwd=2) lines(newdat$x,newdat$tlo,col=&quot;orange&quot;,lty=2,lwd=2) lines(newdat$x,newdat$thi,col=&quot;orange&quot;,lty=2,lwd=2) lines(newdat$x,newdat$bhi,col=&quot;darkgreen&quot;,lty=2,lwd=2) lines(newdat$x,newdat$blo,col=&quot;darkgreen&quot;,lty=2,lwd=2) legend(&quot;topleft&quot;,legend=c(&quot;Fitted line&quot;,&quot;Confidence interval&quot;,&quot;Prediction interval&quot;,&quot;Bootstrapped CI&quot;),col=c(&quot;red&quot;,&quot;blue&quot;,&quot;orange&quot;,&quot;darkgreen&quot;),lty=2,lwd=2,bty=&quot;n&quot;) "],["404.html", "Page not found", " Page not found The page you requested cannot be found (perhaps it was moved or renamed). You may want to try searching to find the page's new location, or use the table of contents to find the page you are looking for. "]]
