[["marginals-effects.html", "14 Paquete marginaleffects Ejemplo", " 14 Paquete marginaleffects En este capítulo se muestran algunas de las utilidades del paquete marginaleffects de Arel-Bundock (2022). Se le recomienda al lector visitar la página oficial del paquete para ver más utilidades. Ejemplo En este ejemplo vamos a construir un modelo mixto para explicar el peso de unos pollitos en función de la edad y la dieta que recibieron (cuatro niveles). A continuación se muestra un diagrama de dispersión que relacion el peso, la edad y las dietas. library(lme4) ## Loading required package: Matrix library(tidyverse) ## ── Attaching packages ## ─────────────────────────────────────── ## tidyverse 1.3.2 ── ## ✔ ggplot2 3.3.6 ✔ purrr 0.3.5 ## ✔ tibble 3.1.8 ✔ dplyr 1.0.10 ## ✔ tidyr 1.2.1 ✔ stringr 1.4.1 ## ✔ readr 2.1.3 ✔ forcats 0.5.2 ## ── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ── ## ✖ tidyr::expand() masks Matrix::expand() ## ✖ dplyr::filter() masks stats::filter() ## ✖ dplyr::lag() masks stats::lag() ## ✖ tidyr::pack() masks Matrix::pack() ## ✖ tidyr::unpack() masks Matrix::unpack() library(patchwork) library(marginaleffects) ## Warning: package &#39;marginaleffects&#39; was built under R version 4.2.2 library(ggplot2) ggplot(data = ChickWeight, aes(x = Time, y = weight, col=Diet)) + geom_point() + theme_bw() + facet_wrap(~ Chick) + labs(y = &quot;Weight (gr)&quot;, x = &quot;Time (days)&quot;) + theme(legend.position = &quot;right&quot;) De la figura anterior se observa claramente que a medida que aumenta el tiempo, el peso de los pollitos aumenta. Las trayectorias de la evolución del peso corporal parecen tener un patrón lineal o cuadrático del tiempo. Inicialmente vamos a ajustar dos modelos, en el primero la media \\(\\mu\\) se modelará en función del tiempo y en el segundo será una función de grado dos del tiempo. A continuación los dos modelos. # unconditional linear growth model fit1 &lt;- lmer( weight ~ 1 + Time + (1 + Time | Chick), data = ChickWeight) # conditional quadratic growth model fit2 &lt;- lmer( weight ~ 1 + Time + I(Time^2) + Diet + Time:Diet + I(Time^2):Diet + (1 + Time + I(Time^2) | Chick), data = ChickWeight) Usando la información de los modelos ajustados es posible pred1 &lt;- predictions(fit1, newdata = datagrid(Chick = ChickWeight$Chick, Time = 0:21)) p1 &lt;- ggplot(pred1, aes(Time, predicted, level = Chick)) + geom_line() + labs(y = &quot;Predicted weight&quot;, x = &quot;Time&quot;, title = &quot;Linear growth model&quot;) pred2 &lt;- predictions(fit2, newdata = datagrid(Chick = ChickWeight$Chick, Time = 0:21)) p2 &lt;- ggplot(pred2, aes(Time, predicted, level = Chick)) + geom_line() + labs(y = &quot;Predicted weight&quot;, x = &quot;Time&quot;, title = &quot;Quadratic growth model&quot;) p1 + p2 Predicciones para cada pollito, en los 4 mundos contrafactuales con diferentes valores para la variable Dieta: pred &lt;- predictions(fit2) ggplot(pred, aes(Time, predicted, level = Chick)) + geom_line() + ylab(&quot;Predicted Weight&quot;) + facet_wrap(~ Diet, labeller = label_both) Para hacer predicciones a nivel de población, establecemos la variable Chick en NA y establecemos include_ranom=FALSE. Este último argumento lo ofrece la función insight::get_predicted que se usa en segundo plano para calcular predicciones: pred &lt;- predictions( fit2, newdata = datagrid(Chick = NA, Diet = 1:4, Time = 0:21), include_random = FALSE) ggplot(pred, aes(x = Time, y = predicted, ymin = conf.low, ymax = conf.high)) + geom_ribbon(alpha = .1, fill = &quot;red&quot;) + geom_line() + facet_wrap(~ Diet, labeller = label_both) + labs(title = &quot;Population-level trajectories&quot;) References "],["404.html", "Page not found", " Page not found The page you requested cannot be found (perhaps it was moved or renamed). You may want to try searching to find the page's new location, or use the table of contents to find the page you are looking for. "]]
